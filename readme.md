# Interactive Hot Spring Water Simulation System

![showcase](/media/showcase.mp4)

This project presents a comprehensive real-time water simulation system that recreates the visual and physical behavior of a hot spring nestled in a rocky mountain environment. At its heart lies a sophisticated heightfield-based water simulation that responds dynamically to user interaction and environmental objects, creating realistic ripples, waves, and light patterns that bring the scene to life.

The simulation employs a GPU-accelerated approach where the water surface is represented as a 2D heightfield texture, with each pixel storing the elevation of the water at that location. This technique allows the surface to respond naturally to disturbances, creating authentic wave propagation when users interact with the water or when floating objects move through it. The system combines physically-inspired behavior with real-time graphics rendering, producing an experience that feels both immersive and responsive.

The core of the water physics is managed by a dedicated simulation pipeline that maintains two floating-point render targets serving as double buffers to store and update the heightfield over time. The simulation operates through a series of GPU fragment shaders, each handling a specific aspect of the water dynamics. The drop shader introduces disturbances such as ripples from user clicks or falling objects, while the update shader advances the simulation forward using numerical approximations of the wave equation. Surface normals are recalculated from the heightfield for proper lighting and shading, and a displacement shader modifies the heightfield when moving objects interact with the fluid.

Each simulation step involves rendering full-screen quads using custom shader materials onto target textures, effectively performing GPGPU computation. The update shader implements the core wave physics by sampling each point's height and velocity from the texture, then comparing the current height with the average of its four immediate neighbors. The difference represents surface curvature, which drives acceleration toward local equilibrium - mimicking how real water behaves under surface tension. A damping factor prevents waves from bouncing forever, while careful parameter tuning maintains numerical stability.

The visual rendering layer transforms the evolving heightfield into a physically-inspired water appearance through advanced vertex and fragment shaders. The water geometry uses a finely tessellated plane with 200x200 subdivisions, providing enough vertex density for smooth displacement and proper normal calculation. The vertex shader samples the heightfield texture at each vertex position, displacing vertices vertically using the stored height values while transforming the flat geometry into a dynamically rippling surface.

The fragment shader creates the complex visual appearance of water by combining refraction, reflection, Fresnel effects, and light distortion. It reconstructs surface normals from the heightfield by examining slope changes between neighboring pixels, then uses these normals to compute reflected and refracted rays through the water. The shader traces these rays into the scene using analytical functions rather than geometry, checking for intersections with the floating sphere, pool walls, and boundaries. Fresnel calculations determine the mixing ratio between reflection and refraction based on viewing angle, while different color tints simulate how light changes as it passes through water.

A sophisticated caustics system generates the characteristic shimmering light patterns that appear on pool surfaces when sunlight refracts through moving water. The caustics renderer uses the water heightfield to calculate how light rays bend as they pass through the surface, projecting these distorted rays onto the pool floor and walls. Where rays converge, bright caustic patterns appear; where they diverge, shadows form. The system computes this by comparing the positions where flat-surface light would hit versus where deformed-surface light actually lands, using the area difference to determine light intensity.

The caustics fragment shader combines three distinct contributions: caustic intensity based on ray convergence and divergence, soft shadows from the floating sphere computed through ray-sphere intersection tests, and rim shadows near pool boundaries where refracted rays get clipped. All calculations happen in screen space using geometric approximations, but the results capture the depth and motion expected from full volumetric light simulation.

Environmental elements enhance the hot spring atmosphere through procedural smoke effects and detailed pool geometry. The smoke system uses animated vertex shaders to create rising steam that twists and sways over time, driven by noise textures and time-based distortion. Multiple smoke planes with random orientations create convincing volumetric effects without expensive fluid simulation. The pool geometry consists of manually constructed cube faces that receive projected caustics and respond to water level changes, with submerged surfaces rendered in tinted underwater colors.

The floating sphere provides a focal point for interaction, implementing simple physics including gravity, buoyancy, and drag forces. When users drag the sphere through the water, it generates realistic displacement effects by modifying the heightfield based on volumetric calculations. The sphere's movement creates ripples that propagate naturally across the surface, while its submerged portions cast soft shadows in the caustics system.

User interaction is handled through mouse-based controls that allow clicking and dragging the sphere in 3D space using ray-plane intersection. Clicks on the water surface inject localized ripples at the interaction point, while camera controls enable exploration both above and below the water surface. The rendering system adapts seamlessly to underwater viewing, flipping surface normals and adjusting color grading to maintain visual consistency from any vantage point.

The complete system integrates multiple specialized shader programs working in concert: simulation shaders that evolve the heightfield physics, rendering shaders that create the water's visual appearance, caustics shaders that generate light patterns, and utility shaders that handle common operations like ray intersection and surface normal reconstruction. A comprehensive set of uniforms allows real-time parameter adjustment, enabling fine-tuning of visual and physical properties without recompilation.

The orchestration layer coordinates all components through a main update loop that advances the water simulation, updates caustic patterns, refreshes reflection maps, processes user input, and renders the complete scene. Environmental models including mountains and pine trees create a convincing hot spring setting, while dynamic sky rendering provides realistic lighting and reflection sources.

This water simulation system demonstrates how modern GPU computing can create compelling real-time physics and rendering effects. By carefully balancing physical accuracy with visual appeal, it produces an interactive experience that captures the essential character of water - its responsiveness to disturbance, its complex light interactions, and its ability to create mesmerizing patterns of motion and illumination. The result is a technical achievement that serves as both a demonstration of advanced graphics programming and an engaging interactive experience.
